<script type="text/javascript" id="tutorialScript">
  var stateVars = {
  'HHTutorial.hhpop[0].biophysics.membraneProperties.naChans.naChan.m.q': true,
  'HHTutorial.hhpop[0].biophysics.membraneProperties.naChans.naChan.h.q': true,
  'HHTutorial.hhpop[0].biophysics.membraneProperties.kChans.kChan.n.q': true,
  'HHTutorial.hhpop[0].biophysics.membraneProperties.naChans.gDensity': true,
  'HHTutorial.hhpop[0].biophysics.membraneProperties.kChans.gDensity': true,
  'HHTutorial.hhpop[0].biophysics.membraneProperties.naChans.iDensity': true,
  'HHTutorial.hhpop[0].biophysics.membraneProperties.kChans.iDensity': true
  }
  document.getElementById('actVars').onclick = function() {
      var actVars = ['HHTutorial.hhpop[0].biophysics.membraneProperties.naChans.naChan.m.q',
                  'HHTutorial.hhpop[0].biophysics.membraneProperties.naChans.naChan.h.q',
                  'HHTutorial.hhpop[0].biophysics.membraneProperties.kChans.kChan.n.q'];
      for (var v of actVars)
          stateVars[v] = this.checked;
  };

  document.getElementById('gDensity').onclick = function() {
      var gDensity = ['HHTutorial.hhpop[0].biophysics.membraneProperties.naChans.gDensity',
                      'HHTutorial.hhpop[0].biophysics.membraneProperties.kChans.gDensity'];
      for (var v of gDensity)
          stateVars[v] = this.checked;
  };

  document.getElementById('iDensity').onclick = function() {
      var iDensity = ['HHTutorial.hhpop[0].biophysics.membraneProperties.naChans.iDensity',
                      'HHTutorial.hhpop[0].biophysics.membraneProperties.kChans.iDensity'];
      for (var v of iDensity)
          stateVars[v] = this.checked;
  };

  GEPPETTO.on(GEPPETTO.Events.Project_persisted, function() {
      $('.tutorialForm input, .tutorialForm button').prop('disabled', false);
  });

  if (!Project.persisted) {
      $('.tutorialForm input, .tutorialForm button').prop('disabled', true);
  }

  document.getElementById('changeCurrent').onclick = function() {
       quickExperiment('IClamp',
            {
                _vActive:{'Model.neuroml.hhneuron.vClamp.active':0},
                i:{'Model.neuroml.hhneuron.IClamp.amplitude':$('#currentValue').val()},
                k:{'Model.neuroml.hhneuron.biophysics.membraneProperties.kChans.condDensity':$('#kValue').val()},
                na:{'Model.neuroml.hhneuron.biophysics.membraneProperties.naChans.condDensity':$('#naValue').val()}
  },
  stateVars
        );
  }

  document.getElementById('persist').onclick = function() {
  if (!GEPPETTO.UserController.hasPermission(GEPPETTO.Resources.WRITE_PROJECT)) {
      var message = "Projects can only be persisted by registered users. Please <a href='" + window.osbURL + "/login' target='_blank'>log in</a> or <a href='" + window.osbURL + "/account/register' target='_blank'>register</a> for an account.";
      GEPPETTO.ModalFactory.infoDialog("Cannot persist experiment", message);
  } else {
      GEPPETTO.on(GEPPETTO.Events.Project_persisted, function() { GEPPETTO.Spinner.hideSpinner(); })
      GEPPETTO.Spinner.showSpinner("Persisting project…");
      Project.persist();
   }
  }
  </script>
<div>
  <p>A single compartment, (10 μm long, 3.18 μm diameter, 100 μm2 surface area) is being simulated containing a passive leak current (reversal potential -54.3mV) and <a onclick="showModelDescription(Model.neuroml.naChan);">sodium</a> and <a onclick="showModelDescription(Model.neuroml.kChan);">potassium</a> active conductances.<p>

    <p>Below you will see a selection of parameters for you to get a sense of this model. First you must persist the model by <a id="persist">clicking here</a> (or the <i class="fa fa-star"></i> icon in the toolbar). This will take a few seconds, then you can modify the parameters and run the simulation by pressing the "Try it!" button. Every time you press "Try it!" a new experiment will be created. You can find all the experiments that you execute in the tab at the bottom of the browser.</p>

    <p>When the simulation is set running the status icon in the Experiments tab 
        below will change from <i class="fa fa-circle" style="color:#ff5a02"></i> 
        (pre simulation; experiment design phase), to <i class="fa fa-circle" style="color:#0199e8"></i> 
        (in the queue on our servers), to <i class="fa fa-circle" style="color:#ffcc00"></i> (running), 
        and finally to <i class="fa fa-circle" style="color:#649615"></i> (completed).</p>
  
  <p>After the experiment finished running, plots will be displayed for the membrane potential, conductance and current through the Na and K channels.</p>

  <p>In this step the model is in IClamp mode which means you are injecting a current into the cell, you can vary the amplitude of the injected current below.
    A greater amplitude of injection should lead to a higher firing rate. 
    Try reducing the conductance densities of each of the channels to zero and see what happens.</p>

    <div class="tutorialForm center">
        <div class="tutorialLabel">Input current (nA)</div> <input id="currentValue" type="text" value="0.002"></input></br>
        <div class="tutorialLabel">k conductance density (S/cm<sup>2</sup>)</div>
        <input id="kValue" type="text" value="0.036"></input></br>
        <div class="tutorialLabel">na conductance density (S/cm<sup>2</sup>)</div> <input id="naValue" type="text" value="0.12"></input></br>
        <div class="tutorialLabel">Record activation variables</div>
        <input id="actVars" type="checkbox" checked></input></br>
        <div class="tutorialLabel">Record conductance densities</div>
        <input id="gDensity" type="checkbox" checked></input></br>
        <div class="tutorialLabel">Record current densities</div>
        <input id="iDensity" type="checkbox" checked></input></br>
        <button class="btn" id="changeCurrent">Try it!  (Log in and press <i class="fa fa-star"></i> above first)</button>
    </div>
</div>
